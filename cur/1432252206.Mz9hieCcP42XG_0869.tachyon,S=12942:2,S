From rswatjfet.org+caf_=rsw=jfet.org@gmail.com  Fri Jul  4 12:03:55 2014
Return-Path: <rswatjfet.org+caf_=rsw=jfet.org@gmail.com>
Received: from mail-pd0-f170.google.com (mail-pd0-f170.google.com [209.85.192.170])
	by antiproton.jfet.org (8.14.4/8.14.4/Debian-4.1) with ESMTP id s64G3sfq019932
	(version=TLSv1/SSLv3 cipher=RC4-SHA bits=128 verify=NOT)
	for <rsw@jfet.org>; Fri, 4 Jul 2014 12:03:55 -0400
Received: by mail-pd0-f170.google.com with SMTP id z10so2130161pdj.15
        for <rsw@jfet.org>; Fri, 04 Jul 2014 09:03:48 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20130820;
        h=x-original-authentication-results:delivered-to:content-type
         :mime-version:subject:in-reply-to:date:message-id:references:to:cc
         :precedence:list-id:list-unsubscribe:list-archive:list-post
         :list-help:list-subscribe:errors-to:sender:from;
        bh=ngtNFX9JP7IDyScrcBy5/iHfnJteHJpT1hP/QmpRuCg=;
        b=L2fTL1+CRCObLxQ6uN3o4oAgmoMcNLDsa1uRXL39PcR+OFkAy+CQmoNntpCu1smL/U
         /D4uTUn4ZrnXLfOeoe19IdeqNvqKXtrzESi7/lBxQA/zGHElzSCBjqwNZMx7MyYi4Hik
         E2riakdl7rwf2eEN8ICg21j2X6GSZY/LWaWFI2ql0AIAM37jvn6c3BfjLVmhKxY4Xv0s
         DV4pqb3UYCdyq8cv9Heq4ICiJ1WD/v3hr3gwcjV2Kj9qsazrDpJup6GTLgxxLRaKPhii
         rk+AAOpoITw3BfgQsQpAD2+TwgTwSO8TaxtSDxi6T33g/OEyl3hgu8UMi7nLs1eptXfg
         IDcA==
X-Original-Authentication-Results: mx.google.com;       spf=neutral (google.com: 209.141.47.85 is neither permitted nor denied by domain of rsw+cypherpunks-bounces=cpunks.org@gloop.phonon.net) smtp.mail=rsw+cypherpunks-bounces=cpunks.org@gloop.phonon.net
X-Received: by 10.70.91.80 with SMTP id cc16mr3814817pdb.133.1404489828655;
        Fri, 04 Jul 2014 09:03:48 -0700 (PDT)
X-Forwarded-To: rsw@jfet.org
X-Forwarded-For: rswatjfet.org@gmail.com rsw@jfet.org
Delivered-To: rswatjfet.org@gmail.com
Received: by 10.70.25.164 with SMTP id d4csp106135pdg;
        Fri, 4 Jul 2014 09:03:47 -0700 (PDT)
X-Received: by 10.70.140.230 with SMTP id rj6mr10805346pdb.18.1404489827448;
        Fri, 04 Jul 2014 09:03:47 -0700 (PDT)
Received: from localhost (antiproton.jfet.org. [209.141.47.85])
        by mx.google.com with ESMTPS id zm3si35585665pac.97.2014.07.04.09.03.46
        for <rswATjfet.org@gmail.com>
        (version=TLSv1.2 cipher=RC4-SHA bits=128/128);
        Fri, 04 Jul 2014 09:03:47 -0700 (PDT)
Received-SPF: neutral (google.com: 209.141.47.85 is neither permitted nor denied by domain of rsw+cypherpunks-bounces=cpunks.org@gloop.phonon.net) client-ip=209.141.47.85;
Authentication-Results: mx.google.com;
       spf=neutral (google.com: 209.141.47.85 is neither permitted nor denied by domain of rsw+cypherpunks-bounces=cpunks.org@gloop.phonon.net) smtp.mail=rsw+cypherpunks-bounces=cpunks.org@gloop.phonon.net
Received: from antiproton.jfet.org (localhost.localdomain [127.0.0.1])
	by antiproton.jfet.org (8.14.4/8.14.4/Debian-4.1) with ESMTP id s64G2g4n019911;
	Fri, 4 Jul 2014 12:02:47 -0400
Received: from wintermute.netteksolutions.com (wintermute.netteksolutions.com
 [69.164.195.240])
 by antiproton.jfet.org (8.14.4/8.14.4/Debian-4.1) with ESMTP id s64G2Zo2019903
 (version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=NOT)
 for <cypherpunks@cpunks.org>; Fri, 4 Jul 2014 12:02:36 -0400
Received: from localhost (localhost [127.0.0.1])
 by wintermute.netteksolutions.com (Postfix) with ESMTP id 800DA1A9E7;
 Fri,  4 Jul 2014 11:02:22 -0500 (CDT)
X-Virus-Scanned: Debian amavisd-new at wintermute.netteksolutions.com
Received: from wintermute.netteksolutions.com ([127.0.0.1])
 by localhost (wintermute.netteksolutions.com [127.0.0.1]) (amavisd-new,
 port 10024)
 with ESMTP id nAXFgXf-2dqG; Fri,  4 Jul 2014 11:02:20 -0500 (CDT)
Received: from bl4cksun.home (216-189-194-199.taylortel.net [216.189.194.199])
 (Authenticated sender: scott@sbce.org)
 by wintermute.netteksolutions.com (Postfix) with ESMTPSA id 2EB681A97C;
 Fri,  4 Jul 2014 11:02:12 -0500 (CDT)
Content-Type: multipart/signed;
 boundary="Apple-Mail=_6B615061-9767-4B2C-80B4-A723876B7B3B";
 protocol="application/pgp-signature"; micalg=pgp-sha512
Mime-Version: 1.0 (Mac OS X Mail 7.3 \(1878.6\))
Subject: Re: messing with XKeyScore
In-Reply-To: <20140704145641.GP26986@leitl.org>
Date: Fri, 4 Jul 2014 11:02:07 -0500
Message-Id: <88301F56-A159-4E79-8E19-E78B7B43F01C@sbce.org>
References: <20140704145641.GP26986@leitl.org>
To: Eugen Leitl <eugen@leitl.org>
X-Mailer: Apple Mail (2.1878.6)
Cc: cypherpunks@cpunks.org, tor-talk@lists.torproject.org,
        Liberation Technologies <liberationtech@mailman.stanford.edu>
X-BeenThere: cypherpunks@cpunks.org
X-Mailman-Version: 2.1.16
Precedence: list
List-Id: The Cypherpunks Mailing List <cypherpunks.cpunks.org>
List-Unsubscribe: <https://cpunks.org/mailman/options/cypherpunks>,
 <mailto:cypherpunks-request@cpunks.org?subject=unsubscribe>
List-Archive: <http://cpunks.org/pipermail/cypherpunks/>
List-Post: <mailto:cypherpunks@cpunks.org>
List-Help: <mailto:cypherpunks-request@cpunks.org?subject=help>
List-Subscribe: <https://cpunks.org/mailman/listinfo/cypherpunks>,
 <mailto:cypherpunks-request@cpunks.org?subject=subscribe>
Errors-To: cypherpunks-bounces@cpunks.org
Sender: "cypherpunks" <cypherpunks-bounces@cpunks.org>
From: Scott Blaydes <scott@sbce.org>
X-Gspam-Loop: antiproton.jfet.org
Status: O
Content-Length: 7589
Lines: 172


--Apple-Mail=_6B615061-9767-4B2C-80B4-A723876B7B3B
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=windows-1252

You will know this has worked when a wall of the NSA=92s Utah Data =
Center bulges and bursts spilling bits and bytes all over the desert.

On Jul 4, 2014, at 9:56 AM, Eugen Leitl <eugen@leitl.org> wrote:

>=20
> http://blog.erratasec.com/2014/07/jamming-xkeyscore_4.html?m=3D1=20
>=20
> Errata Security
>=20
> Advanced persistent cybersecurity
>=20
> Friday, July 04, 2014
>=20
> Jamming XKeyScore
>=20
> Back in the day there was talk about "jamming echelon" by adding =
keywords to email that the echelon system was supposedly looking for. We =
can do the same thing for XKeyScore: jam the system with more =
information than it can handle. (I enumerate the bugs I find in the code =
as "xks-00xx").
>=20
>=20
> For example, when sending emails, just send from the address =
"bridges@torproject.org" and in the email body include:
>=20
> https://bridges.torproject.org/
> bridge =3D 0.0.0.1:443
> bridge =3D 0.0.0.2:443
> bridge =3D 0.0.0.3:443
> ...
>=20
> Continue this for megabytes worth of bridges (xks-0001), and it'll =
totally mess up XKeyScore. It has no defense against getting flooded =
with information like this, as far as I can see.
>=20
>=20
> Note that the regex only cares about 1 to 3 digit numbers, that means =
the following will be accepted by the system (xks-0002):
>=20
> bridge =3D 75.748.86.91:80
>=20
> The port number matches on 2 to 4 digits ([0-9]{2,4}). Therefore, =
bridges with port numbers below 10 and above 9999 will be safe. I don't =
know if this code reflect a limitation in Tor, or but assuming high/low =
ports are possible, this can be used to evade detection (xks-0011).
>=20
> Strangely, when the port number is parsed, it'll capture the first =
non-digit character after the port number (xks-0012). This is normally =
whitespace, but we could generate an email with 256 entries, trying =
every possible character. A character like < or ' might cause various =
problems in rendering on an HTML page or generating SQL queries.
>=20
>=20
> You can also jam the system with too many Onion addresses (xks-0003), =
but there are additional ways to screw with those. When looking for =
Onion addresses, the code uses a regex that contains the following =
capture clause:
>=20
> ([a-z]+):\/\/)
>=20
> This is looking for a string like "http://" or "https://", but the =
regex has no upper bounds (xks-0004) and there is no validation. Thus, =
you can include "goscrewyourself://o987asgia7gsdfoi.onion:443/" in =
network traffic, and it'll happily insert this into the database. But =
remember that "no upper bounds" means just that: the prefix can be =
kilobytes long, megabytes long, or even gigabytes long. You can open a =
TCP connection to a system you feel the NSA is monitoring, send 5 =
gigabytes of lower-case letters, followed by the rest of the Onion =
address, and see what happens. I mean, there is some practical upper =
bound somewhere in the system,, and when you hit it, there's a good =
chance bad things will happen.
>=20
> Likewise, the port number for Onion address is captured by the regex =
(d+), meaning any number of digits (xks-0005). Thus, we could get =
numbers that overflow 16-bits, 32-bits, 64-bits, or 982745987-bits. Very =
long strings of digits (megabytes) at this point might cause bad things =
to happen within the system.
>=20
> There is an extra-special thing that happens when the schema part of =
the Onion address is exactly 16-bytes long (xks-0006). This will cause =
the address and the scheme to reverse themselves when inserted into the =
database. Thus, we can insert digits into the scheme field. This might =
foul up later code that assumes schemes only contain letters, because =
only letters match in the regex.
>=20
>=20
> In some protocol fields, the regexes appear to be partial matches. The =
system appears to match on HTTP servers with "mixminion" anywhere in the =
name. Thus, we start causing lots of traffic to go to our domains, such =
as "mixminion.robertgraham.com", that will cause their servers to fill =
up with long term storage of sessions they don't care about (xks-0007)
>=20
>=20
> Let's talk X.509, and the following code:
>=20
> fingerprint('anonymizer/tor/bridge/tls') =3D
>  ssl_x509_subject('bridges.torproject.org') or
>  ssl_dns_name('bridges.torproject.org');
>=20
> Code that parses X.509 certificates is known to be flaky as all get =
out. The simplest thing to do is find a data center you feel the NSA can =
monitor, and then setup a hostile server that can do generic fuzzing of =
X.509 certificates, trying to crash them.
>=20
> It's likely that whatever code is parsing X.509 certificates is not =
validating them. Thus, anybody can put certificates on their servers =
claiming to be 'bridges.torproject.org' (xks-0008). It's likely that the =
NSA is parsing SSL on all ports, so just pick a random port on your =
server not being used for anything else, create a self-signed CERT =
claiming to be "bridges.torproject.org', then create incoming links to =
that port from other places so at least search-engines will follow that =
link and generate traffic. This will cause the NSA database of bridges =
to fill up with bad information -- assuming it's not already full from =
people screwing with the emails as noted above :).
>=20
>=20
> <img src=3D"http://www.google.com/?q=3Dtails+usb" />
>=20
> Putting the above code in a web page like this one will cause every =
visitor to trigger a search for TAILS in the XKeyScore rules. The more =
people who do this, the less useful it becomes to the NSA (xks-0009) in =
labeling people as suspicious. Likewise, putting =
<title>tails.boum.org/<.title> in your webpages will cause the same =
effect, even when CSS/JavaScript makes such a title invisible.
>=20
>=20
> In theory, the NSA should only be monitoring foreign traffic, and not =
traffic originating from the United States (or, apparently, the other =
five-eyes). So here is the fun thing (xks-0010): run your jamming tools =
from United States IP addresses against those servers in Iran you know =
the NSA is monitoring. Since the code should already be ignoring the =
traffic because it originates from the United States, then they can't =
complain if you've filled up their databases full of Tor Onion and =
bridge addresses.
>=20
> Robert Graham=20


--Apple-Mail=_6B615061-9767-4B2C-80B4-A723876B7B3B
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment;
	filename=signature.asc
Content-Type: application/pgp-signature;
	name=signature.asc
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - https://gpgtools.org

iQIcBAEBCgAGBQJTts//AAoJEAlu7PDYojgekW0QALd3mooKUpqcee9iWv1VtZAd
yHUM28zY/7lYm/6PTKT4pkEWo1PPt/s4VLbsQEHVQAUKMfdFN24+vmNmYxODAyni
DHbDYxdup6TrkhwVlt17sneeo3pJL9Ffkjh4vxW1ysMn2F1OOuCGvsY74Beh1tao
aK/tA0K1iJ8KAh63MEQRnzKi5gV/vIUzIDhF10bxBUfJeubU9Iq8B4LrnQr8Lt26
rL9HOKnNE++hK+8CPmnwdCWefwRU7AITYuxiOJFc2qjtxFr9Q90pUkCjUAd7u9A6
R63Cv62C9j0UWciTDAOMuSiXmWaGnycRppnAfUwrwjit79074/44Jy8rFcwVsbTH
SX/d9MPGb1yQRCws3s7xpBmuE079hWtcjs/KbsgElvW0WSOYWpnxq+nTjLr8A2o4
oXfRxOMa32xM4kBiOxywePhypnbt3/UHVvgKcn/hG61cUi6yTLfVrmX4KpXmeX9s
cTC5GIplTzruIzEjYugcJkNsma+4j1H1JBzVKzvWeKwBx50CdW65g2/DhYGdgyId
Flsr9ml5bd2ueyb+/Qvytrz+7QDSAAzRz/UTzlF2D4hkINP6apgG3o27k/nxVBXy
pvdxlArHl10up4oRE/nx/IuwEmeqo3G4dKUAyCa+yVKuQCJ1/pHDHJf18aakEtXT
4yUKf0Tin8Qud+QmSsK8
=W1OW
-----END PGP SIGNATURE-----

--Apple-Mail=_6B615061-9767-4B2C-80B4-A723876B7B3B--

